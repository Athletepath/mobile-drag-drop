/*! mobile-drag-drop 2.2.0 | Copyright (c) 2017 Tim Ruffles | MIT License */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.MobileDragDrop={})}(this,function(t){"use strict";function e(){var t={dragEvents:"ondragstart"in document.documentElement,draggable:"draggable"in document.documentElement,touchEvents:"ontouchstart"in document.documentElement,userAgentSupportingNativeDnD:void 0},e=!!window.chrome||/chrome/i.test(navigator.userAgent);return t.userAgentSupportingNativeDnD=!(/iPad|iPhone|iPod|Android/.test(navigator.userAgent)||e&&t.touchEvents),E&&Object.keys(t).forEach(function(t){}),t}function r(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(t){}return t}function a(t){if(!I){var e=i(t);if(e)try{I=new H(t,b,e,n)}catch(e){throw n(b,t,3),e}}}function i(t){var e=t.target;do{if(!1!==e.draggable&&e.getAttribute&&"true"===e.getAttribute("draggable"))return e}while((e=e.parentNode)&&e!==document.body)}function n(t,e,r){if(0===r&&t.defaultActionOverride)try{t.defaultActionOverride(e),e.defaultPrevented}catch(t){}I=null}function o(t,e,r){void 0===r&&(r=!0),document.addEventListener(t,e,!!S&&{passive:r})}function s(t,e){document.removeEventListener(t,e)}function d(t){return 0===t.length?0:t.reduce(function(t,e){return e+t},0)/t.length}function c(t){return t&&t.tagName}function h(t,e){for(var r=0;r<t.changedTouches.length;r++)if(t.changedTouches[r].identifier===e)return!0;return!1}function u(t,e,r,a,i,n,o){void 0===o&&(o=null);var s=e.changedTouches[0],d=new Event(r,{bubbles:!0,cancelable:a});d.dataTransfer=n,d.relatedTarget=o,d.screenX=s.screenX,d.screenY=s.screenY,d.clientX=s.clientX,d.clientY=s.clientY,d.pageX=s.pageX,d.pageY=s.pageY;var c=t.getBoundingClientRect();return d.offsetX=d.clientX-c.left,d.offsetY=d.clientY-c.top,d}function g(t,e,r){for(var a=[],i=[],n=0;n<e.touches.length;n++){var o=e.touches[n];a.push(o[t+"X"]),i.push(o[t+"Y"])}r.x=d(a),r.y=d(i)}function f(t,e){if(1===t.nodeType){for(var r=getComputedStyle(t),a=0;a<r.length;a++){var i=r[a];e.style.setProperty(i,r.getPropertyValue(i),r.getPropertyPriority(i))}e.style.pointerEvents="none",e.removeAttribute("id"),e.removeAttribute("class"),e.removeAttribute("draggable")}if(t.hasChildNodes())for(a=0;a<t.childNodes.length;a++)f(t.childNodes[a],e.childNodes[a])}function _(t){var e=t.cloneNode(!0);return f(t,e),e.style.position="absolute",e.style.left="0px",e.style.top="0px",e.style.zIndex="999999",e.classList.add(A),e.classList.add(N),e}function l(t){return L.map(function(e){var r=t.style[e+"transform"];return r&&"none"!==r?r.replace(/translate\(\D*\d+[^,]*,\D*\d+[^,]*\)\s*/g,""):""})}function p(t,e,r,a,i){void 0===i&&(i=!0);var n=e.x,o=e.y;a&&(n+=a.x,o+=a.y),i&&(n-=parseInt(t.offsetWidth,10)/2,o-=parseInt(t.offsetHeight,10)/2);for(var s="translate3d("+n+"px,"+o+"px, 0)",d=0;d<L.length;d++){var c=L[d]+"transform";t.style[c]=s+" "+r[d]}}function m(t,e,r,a){var i=getComputedStyle(t);if("hidden"!==i.visibility&&"none"!==i.display){e.classList.add(P);var n=getComputedStyle(e),o=parseFloat(n.transitionDuration);if(isNaN(o)||0===o)a();else{var s=t.getBoundingClientRect(),d={x:s.left,y:s.top};d.x+=document.body.scrollLeft||document.documentElement.scrollLeft,d.y+=document.body.scrollTop||document.documentElement.scrollTop,d.x-=parseInt(i.marginLeft,10),d.y-=parseInt(i.marginTop,10);var c=parseFloat(n.transitionDelay),h=Math.round(1e3*(o+c));p(e,d,r,void 0,!1),setTimeout(a,h)}}else a()}function v(t,e){return t?t===C[0]?x[0]:0===t.indexOf(C[1])||t===C[7]?x[1]:0===t.indexOf(C[4])?x[3]:t===C[6]?x[2]:x[1]:3===e.nodeType&&"A"===e.tagName?x[3]:x[1]}function T(t,e,r,a,i,n,o){if(void 0===n&&(n=!0),void 0===o&&(o=null),E){var s=w+"debug",d=w+"event-target",c=w+"event-related-target";e.classList.add(s),e.classList.add(d),o&&(o.classList.add(s),o.classList.add(c))}var h=u(e,r,t,n,document.defaultView,i,o),g=!e.dispatchEvent(h);return a._mode=0,E&&(e.classList.remove(d),o&&o.classList.remove(c)),g}function y(t,e){if(!t||t===C[7])return e;if(e===x[1]){if(0===t.indexOf(x[1]))return x[1]}else if(e===x[3]){if(0===t.indexOf(x[3])||t.indexOf("Link")>-1)return x[3]}else if(e===x[2]&&(0===t.indexOf(x[2])||t.indexOf("Move")>-1))return x[2];return x[0]}function D(t){var e=t.target,r=function(t){n.off(),o.off(),s.off(),clearTimeout(i)},i=setTimeout(function(){n.off(),o.off(),s.off(),a(t)},b.holdToDrag),n=O(e,"touchend",r),o=O(e,"touchcancel",r),s=O(window.document,"scroll",r,!0)}function O(t,e,r,a){void 0===a&&(a=!1);var i=S?{passive:!0,capture:a}:a;return t.addEventListener(e,r,i),{off:function(){t.removeEventListener(e,r,i)}}}var S,I,E=!1,b={iterationInterval:150},C=["none","copy","copyLink","copyMove","link","linkMove","move","all"],x=["none","copy","move","link"],L=["","-webkit-"],w="dnd-poly-",A=w+"drag-image",P=w+"snapback",N=w+"icon",H=function(){function t(t,e,r,a){this._initialEvent=t,this._config=e,this._sourceNode=r,this._dragOperationEndedCb=a,this._dragOperationState=0,this._immediateUserSelection=null,this._currentDropTarget=null,this._lastTouchEvent=t,this._initialTouch=t.changedTouches[0],this._touchMoveHandler=this._onTouchMove.bind(this),this._touchEndOrCancelHandler=this._onTouchEndOrCancel.bind(this),o("touchmove",this._touchMoveHandler,!1),o("touchend",this._touchEndOrCancelHandler,!1),o("touchcancel",this._touchEndOrCancelHandler,!1)}return t.prototype._setup=function(){var t=this;this._dragOperationState=1,this._currentDragOperation=x[0],this._dragDataStore={_data:{},_effectAllowed:void 0,_mode:3,_types:[]},this._currentHotspotCoordinates={x:null,y:null},this._dragImagePageCoordinates={x:null,y:null};var e=this._sourceNode;if(this._dataTransfer=new M(this._dragDataStore,function(r,a,i){e=r,"number"!=typeof a&&"number"!=typeof i||(t._dragImageOffset={x:a||0,y:i||0})}),this._dragDataStore._mode=2,this._dataTransfer.dropEffect=x[0],T("dragstart",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer))return this._dragOperationState=3,this._cleanup(),!1;if(g("page",this._lastTouchEvent,this._dragImagePageCoordinates),this._dragImage=_(e),this._dragImageTransforms=l(this._dragImage),!this._dragImageOffset)if(this._config.dragImageOffset)this._dragImageOffset={x:this._config.dragImageOffset.x,y:this._config.dragImageOffset.y};else if(this._config.dragImageCenterOnTouch){a=getComputedStyle(e);this._dragImageOffset={x:0-parseInt(a.marginLeft,10),y:0-parseInt(a.marginTop,10)}}else{var r=e.getBoundingClientRect(),a=getComputedStyle(e);this._dragImageOffset={x:r.left-this._initialTouch.clientX-parseInt(a.marginLeft,10)+r.width/2,y:r.top-this._initialTouch.clientY-parseInt(a.marginTop,10)+r.height/2}}return p(this._dragImage,this._dragImagePageCoordinates,this._dragImageTransforms,this._dragImageOffset,this._config.dragImageCenterOnTouch),document.body.appendChild(this._dragImage),this._iterationIntervalId=window.setInterval(function(){t._iterationLock||(t._iterationLock=!0,t._dragAndDropProcessModelIteration(),t._iterationLock=!1)},this._config.iterationInterval),!0},t.prototype._cleanup=function(){this._iterationIntervalId&&(clearInterval(this._iterationIntervalId),this._iterationIntervalId=null),s("touchmove",this._touchMoveHandler),s("touchend",this._touchEndOrCancelHandler),s("touchcancel",this._touchEndOrCancelHandler),this._dragImage&&(this._dragImage.parentNode.removeChild(this._dragImage),this._dragImage=null),this._dragOperationEndedCb(this._config,this._lastTouchEvent,this._dragOperationState)},t.prototype._onTouchMove=function(t){var e=this;if(!1!==h(t,this._initialTouch.identifier)){if(this._lastTouchEvent=t,0===this._dragOperationState){var r=void 0;if(this._config.dragStartConditionOverride)try{r=this._config.dragStartConditionOverride(t)}catch(t){r=!1}else r=1===t.touches.length;return r?void(!0===this._setup()&&(this._initialEvent.preventDefault(),t.preventDefault())):void this._cleanup()}if(t.preventDefault(),g("client",t,this._currentHotspotCoordinates),g("page",t,this._dragImagePageCoordinates),this._config.dragImageTranslateOverride)try{var a=!1;if(this._config.dragImageTranslateOverride(t,{x:this._currentHotspotCoordinates.x,y:this._currentHotspotCoordinates.y},this._immediateUserSelection,function(t,r){e._dragImage&&(a=!0,e._currentHotspotCoordinates.x+=t,e._currentHotspotCoordinates.y+=r,e._dragImagePageCoordinates.x+=t,e._dragImagePageCoordinates.y+=r,p(e._dragImage,e._dragImagePageCoordinates,e._dragImageTransforms,e._dragImageOffset,e._config.dragImageCenterOnTouch))}),a)return}catch(t){}p(this._dragImage,this._dragImagePageCoordinates,this._dragImageTransforms,this._dragImageOffset,this._config.dragImageCenterOnTouch)}},t.prototype._onTouchEndOrCancel=function(t){if(!1!==h(t,this._initialTouch.identifier)){if(this._config.dragImageTranslateOverride)try{this._config.dragImageTranslateOverride(void 0,void 0,void 0,function(){})}catch(t){}0!==this._dragOperationState?(t.preventDefault(),this._dragOperationState="touchcancel"===t.type?3:2):this._cleanup()}},t.prototype._dragAndDropProcessModelIteration=function(){var t=this;if(E)var e=w+"debug",r=w+"immediate-user-selection",a=w+"current-drop-target";var i=this._currentDragOperation;this._dragDataStore._mode=3,this._dataTransfer.dropEffect=x[0];var n=T("drag",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer);if(n&&(this._currentDragOperation=x[0]),n||2===this._dragOperationState||3===this._dragOperationState)return this._dragOperationEnded(this._dragOperationState)?void m(this._sourceNode,this._dragImage,this._dragImageTransforms,function(){t._finishDragOperation()}):void this._finishDragOperation();var o=document.elementFromPoint(this._currentHotspotCoordinates.x,this._currentHotspotCoordinates.y),s=this._currentDropTarget;o!==this._immediateUserSelection&&o!==this._currentDropTarget&&(E&&(this._immediateUserSelection&&this._immediateUserSelection.classList.remove(r),o&&(o.classList.add(e),o.classList.add(r))),this._immediateUserSelection=o,null!==this._currentDropTarget&&(this._dragDataStore._mode=3,this._dataTransfer.dropEffect=x[0],T("dragexit",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1)),null===this._immediateUserSelection?this._currentDropTarget=this._immediateUserSelection:(this._dragDataStore._mode=3,this._dataTransfer.dropEffect=v(this._dragDataStore._effectAllowed,this._sourceNode),T("dragenter",this._immediateUserSelection,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?(this._currentDropTarget=this._immediateUserSelection,this._currentDragOperation=y(this._dataTransfer.effectAllowed,this._dataTransfer.dropEffect)):this._immediateUserSelection!==document.body&&(this._currentDropTarget=document.body))),s!==this._currentDropTarget&&c(s)&&(E&&s.classList.remove(a),this._dragDataStore._mode=3,this._dataTransfer.dropEffect=x[0],T("dragleave",s,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1,this._currentDropTarget)),c(this._currentDropTarget)&&(E&&(this._currentDropTarget.classList.add(e),this._currentDropTarget.classList.add(a)),this._dragDataStore._mode=3,this._dataTransfer.dropEffect=v(this._dragDataStore._effectAllowed,this._sourceNode),!1===T("dragover",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?this._currentDragOperation=x[0]:this._currentDragOperation=y(this._dataTransfer.effectAllowed,this._dataTransfer.dropEffect)),i!==this._currentDragOperation&&this._dragImage.classList.remove(w+i);var d=w+this._currentDragOperation;!1===this._dragImage.classList.contains(d)&&this._dragImage.classList.add(d)},t.prototype._dragOperationEnded=function(t){if(E){var e=w+"immediate-user-selection",r=w+"current-drop-target";this._currentDropTarget&&this._currentDropTarget.classList.remove(r),this._immediateUserSelection&&this._immediateUserSelection.classList.remove(e)}var a=this._currentDragOperation===x[0]||null===this._currentDropTarget||3===t;return a?c(this._currentDropTarget)&&(this._dragDataStore._mode=3,this._dataTransfer.dropEffect=x[0],T("dragleave",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1)):c(this._currentDropTarget)&&(this._dragDataStore._mode=1,this._dataTransfer.dropEffect=this._currentDragOperation,!0===T("drop",this._currentDropTarget,this._lastTouchEvent,this._dragDataStore,this._dataTransfer)?this._currentDragOperation=this._dataTransfer.dropEffect:this._currentDragOperation=x[0]),a},t.prototype._finishDragOperation=function(){this._dragDataStore._mode=3,this._dataTransfer.dropEffect=this._currentDragOperation,T("dragend",this._sourceNode,this._lastTouchEvent,this._dragDataStore,this._dataTransfer,!1),this._dragOperationState=2,this._cleanup()},t}(),M=function(){function t(t,e){this._dataStore=t,this._setDragImageHandler=e,this._dropEffect=x[0]}return Object.defineProperty(t.prototype,"dropEffect",{get:function(){return this._dropEffect},set:function(t){0!==this._dataStore._mode&&C.indexOf(t)>-1&&(this._dropEffect=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"types",{get:function(){if(0!==this._dataStore._mode)return Object.freeze(this._dataStore._types)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"effectAllowed",{get:function(){return this._dataStore._effectAllowed},set:function(t){2===this._dataStore._mode&&C.indexOf(t)>-1&&(this._dataStore._effectAllowed=t)},enumerable:!0,configurable:!0}),t.prototype.setData=function(t,e){if(2===this._dataStore._mode){if(t.indexOf(" ")>-1)throw new Error("illegal arg: type contains space");this._dataStore._data[t]=e,-1===this._dataStore._types.indexOf(t)&&this._dataStore._types.push(t)}},t.prototype.getData=function(t){if(1===this._dataStore._mode||2===this._dataStore._mode)return this._dataStore._data[t]||""},t.prototype.clearData=function(t){if(2===this._dataStore._mode){if(t&&this._dataStore._data[t]){delete this._dataStore._data[t];var e=this._dataStore._types.indexOf(t);return void(e>-1&&this._dataStore._types.splice(e,1))}this._dataStore._data={},this._dataStore._types=[]}},t.prototype.setDragImage=function(t,e,r){2===this._dataStore._mode&&this._setDragImageHandler(t,e,r)},t}();t.polyfill=function(t){if(t&&Object.keys(t).forEach(function(e){b[e]=t[e]}),!b.forceApply){var i=e();if(i.userAgentSupportingNativeDnD&&i.draggable&&i.dragEvents)return!1}return S=r(),b.holdToDrag?o("touchstart",D,!1):o("touchstart",a,!1),!0},Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=index.min.js.map